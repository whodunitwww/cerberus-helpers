return function(a)local b=a.Services;local c=a.References;local d=a.ModuleData or{}local e=a.ScriptVersion or"unknown"local f="https://discord.gg/YOUR_INVITE_HERE"local g={StartTime=tick(),Events={},MaxEvents=160,CrashGui=nil}local function h()local i,j=pcall(os.date,"!%Y-%m-%d %H:%M:%S UTC")return i and j or"unknown-time"end;local function k(l,m)l=tostring(l or"")if#l<=m then return l end;return l:sub(1,m-3).."..."end;local function n(o)local p=string.format("%s | %s",h(),o)g.Events[#g.Events+1]=p;if#g.Events>g.MaxEvents then table.remove(g.Events,1)end;print("[Cerberus/Debug] "..o)end;function g:Log(q,r)n(string.format("[%s] %s",tostring(q or"INFO"),tostring(r or"")))end;function g:GetRuntimeInfo()local s=game.PlaceId or 0;local t=game.JobId or"unknown"local u=c and c.gameName or"Unknown"local v=identifyexecutor and identifyexecutor()or"Unknown"local w="n/a"local x,y=pcall(function()if b and b.Stats and b.Stats.Network then return tostring(b.Stats.Network.ServerStatsItem["Data Ping"]:GetValue())end;return"n/a"end)if x and y then w=y end;return{ScriptVersion=e,Executor=v,GameName=tostring(u),PlaceId=tostring(s),JobId=tostring(t),User=tostring(c and c.player and c.player.Name or"Unknown"),UserId=tostring(c and c.player and c.player.UserId or 0),RuntimeSeconds=string.format("%.2f",tick()-self.StartTime),FetchDone=tostring(d.FetchDone or"?"),FetchTotal=tostring(d.FetchTotal or"?"),CacheVersion=tostring(d.CacheVersion or"unknown"),Ping=w}end;function g:BuildCrashReport(z,A)local B=self:GetRuntimeInfo()local C={"Cerberus Crash Report","Please report this to the Cerberus team with this full report.","","Error Context","Label: "..tostring(z),"Timestamp: "..h(),"","Environment","Script Version: "..B.ScriptVersion,"Executor: "..B.Executor,"Game: "..B.GameName,"PlaceId: "..B.PlaceId,"JobId: "..B.JobId,"Player: "..B.User.." ("..B.UserId..")","Runtime (s): "..B.RuntimeSeconds,"Dependencies: "..B.FetchDone.."/"..B.FetchTotal,"CacheVersion: "..B.CacheVersion,"Ping: "..B.Ping,"","Error",tostring(A),"","Recent Debug Events"}for D,E in ipairs(self.Events)do C[#C+1]=E end;return table.concat(C,"\n")end;function g:ShowCrashGui(F)if self.CrashGui and self.CrashGui.Parent then return end;local G=gethui and gethui()or game:GetService("CoreGui")if not G then warn("[Cerberus/Debug] Could not render crash GUI (no parent).")return end;local H=Instance.new("ScreenGui")H.Name="CerberusCrashGui"H.ResetOnSpawn=false;H.IgnoreGuiInset=true;H.DisplayOrder=10000;H.Parent=G;self.CrashGui=H;local I=Instance.new("Frame")I.Size=UDim2.fromScale(1,1)I.BackgroundColor3=Color3.fromRGB(5,5,7)I.BackgroundTransparency=0.3;I.BorderSizePixel=0;I.Parent=H;local J=Instance.new("Frame")J.Name="MainPanel"J.AnchorPoint=Vector2.new(0.5,0.5)J.Size=UDim2.fromOffset(600,480)J.Position=UDim2.fromScale(0.5,0.5)J.BackgroundColor3=Color3.fromRGB(20,20,24)J.BorderSizePixel=0;J.Parent=I;local K=Instance.new("UICorner")K.CornerRadius=UDim.new(0,12)K.Parent=J;local L=Instance.new("UIStroke")L.Thickness=1.5;L.Transparency=0.0;L.Color=Color3.fromRGB(255,65,65)L.Parent=J;local M=Instance.new("TextLabel")M.BackgroundTransparency=1;M.Size=UDim2.new(1,-24,0,24)M.Position=UDim2.new(0,14,0,14)M.Font=Enum.Font.GothamBold;M.TextSize=22;M.TextColor3=Color3.fromRGB(255,90,90)M.TextXAlignment=Enum.TextXAlignment.Left;M.Text="Cerberus Crash Report"M.Parent=J;local N=Instance.new("TextLabel")N.BackgroundTransparency=1;N.Size=UDim2.new(1,-24,0,20)N.Position=UDim2.new(0,14,0,40)N.Font=Enum.Font.Gotham;N.TextSize=13;N.TextColor3=Color3.fromRGB(180,180,180)N.TextXAlignment=Enum.TextXAlignment.Left;N.Text="An error occurred. Please send this report to the developer."N.Parent=J;local O=Instance.new("ScrollingFrame")O.Name="LogScroller"O.Position=UDim2.new(0,12,0,70)O.Size=UDim2.new(1,-24,1,-125)O.BackgroundColor3=Color3.fromRGB(12,12,14)O.ScrollBarThickness=6;O.ScrollBarImageColor3=Color3.fromRGB(70,70,75)O.BorderSizePixel=0;O.CanvasSize=UDim2.new(0,0,0,0)O.AutomaticCanvasSize=Enum.AutomaticSize.Y;O.Parent=J;local P=Instance.new("UICorner")P.CornerRadius=UDim.new(0,6)P.Parent=O;local Q=Instance.new("UIListLayout")Q.SortOrder=Enum.SortOrder.LayoutOrder;Q.Padding=UDim.new(0,5)Q.Parent=O;local R=Instance.new("UIPadding")R.PaddingLeft=UDim.new(0,8)R.PaddingRight=UDim.new(0,8)R.PaddingTop=UDim.new(0,8)R.PaddingBottom=UDim.new(0,8)R.Parent=O;local S=Instance.new("TextBox")S.Name="LogText"S.MultiLine=true;S.TextEditable=false;S.ClearTextOnFocus=false;S.BackgroundTransparency=1;S.Size=UDim2.new(1,0,0,0)S.AutomaticSize=Enum.AutomaticSize.Y;S.Font=Enum.Font.Code;S.TextSize=13;S.TextColor3=Color3.fromRGB(220,220,220)S.TextXAlignment=Enum.TextXAlignment.Left;S.TextYAlignment=Enum.TextYAlignment.Top;S.TextWrapped=true;S.Text=k(F,50000)S.Parent=O;local T=Instance.new("Frame")T.Name="Buttons"T.BackgroundTransparency=1;T.Size=UDim2.new(1,-24,0,36)T.AnchorPoint=Vector2.new(0,1)T.Position=UDim2.new(0,12,1,-12)T.Parent=J;local U=Instance.new("UIListLayout")U.FillDirection=Enum.FillDirection.Horizontal;U.SortOrder=Enum.SortOrder.LayoutOrder;U.Padding=UDim.new(0,10)U.Parent=T;local function V(W,X,Y,Z)local _=Instance.new("TextButton")_.Size=UDim2.new(0.32,0,1,0)_.BackgroundColor3=X;_.Text=W;_.TextColor3=Color3.new(1,1,1)_.Font=Enum.Font.GothamBold;_.TextSize=12;_.LayoutOrder=Y;_.Parent=T;local a0=Instance.new("UICorner")a0.CornerRadius=UDim.new(0,6)a0.Parent=_;_.MouseButton1Click:Connect(Z)return _ end;local a1=Instance.new("TextLabel")V("Copy Report",Color3.fromRGB(38,87,255),1,function()local i=pcall(setclipboard,F)a1.Text=i and"Copied Report!"or"Copy Failed."a1.TextColor3=i and Color3.fromRGB(100,255,100)or Color3.fromRGB(255,100,100)end)V("Copy Discord",Color3.fromRGB(88,101,242),2,function()local i=pcall(setclipboard,f)a1.Text=i and"Copied Link!"or"Copy Failed."a1.TextColor3=i and Color3.fromRGB(88,101,242)or Color3.fromRGB(255,100,100)end)V("Close",Color3.fromRGB(58,58,66),3,function()if self.CrashGui then self.CrashGui:Destroy()self.CrashGui=nil end end)a1.BackgroundTransparency=1;a1.AnchorPoint=Vector2.new(1,0)a1.Size=UDim2.new(0,200,0,20)a1.Position=UDim2.new(1,-14,0,16)a1.Font=Enum.Font.GothamBold;a1.TextSize=12;a1.TextColor3=Color3.fromRGB(255,255,255)a1.TextXAlignment=Enum.TextXAlignment.Right;a1.Text=""a1.Parent=J end;function g:HandleCrash(z,A)local a2=self:BuildCrashReport(z,A)warn("[Cerberus/Crash]\n"..a2)self:ShowCrashGui(a2)return a2 end;function g:Try(z,a3)self:Log("STEP","Begin "..tostring(z))local a4=table.pack(xpcall(a3,function(a5)return debug.traceback(tostring(a5),2)end))if a4[1]==true then self:Log("STEP","Completed "..tostring(z))return true,table.unpack(a4,2,a4.n)end;self:Log("ERROR",tostring(z).." failed")self:HandleCrash(z,a4[2])return false,a4[2]end;function g:RunOrThrow(z,a3)self:Log("STEP","Begin "..tostring(z))local a4=table.pack(xpcall(a3,function(a5)return debug.traceback(tostring(a5),2)end))if a4[1]==true then self:Log("STEP","Completed "..tostring(z))return table.unpack(a4,2,a4.n)end;error(string.format("[%s] %s",tostring(z),tostring(a4[2])),0)end;function g:LoadModule(a6,a3)local z=string.format("Module %s",tostring(a6))return self:RunOrThrow(z,a3)end;return g end
