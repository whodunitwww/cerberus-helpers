return function(a)local b=a.Services;local c=a.Tabs;local d=a.References;local e=a.Library;local f=a.Toggles;local g=a.Options;local h=a.Unloader;local i=a.quickReset;local j=a.startNoclip;local k=a.stopNoclip;local l=a.PlayerUtilsConfig;if l.Enabled~=true then return end;local m={}local function n(o)if o then m[#m+1]=o end end;local p={enabled=false,pending=false,nextAttemptAt=0,retryDelay=2,maxDelay=20,loop=nil,token=0,conns={}}local function q(o)if o then p.conns[#p.conns+1]=o end;return o end;local function r()for s=#p.conns,1,-1 do local t=p.conns[s]p.conns[s]=nil;pcall(function()if t and t.Disconnect then t:Disconnect()end end)end end;local function u()local v=game:GetService("CoreGui")local w=v and v:FindFirstChild("RobloxPromptGui")if not w then return false end;local x=w:FindFirstChild("promptOverlay")if not x then return false end;local y=x:FindFirstChild("ErrorPrompt")if not y then return false end;return y.Visible==true end;local function z(A)if not p.enabled then return end;p.pending=true;p.reason=A end;local function B()if not p.enabled then return end;local C=os.clock()if C<p.nextAttemptAt then return end;p.nextAttemptAt=C+p.retryDelay;local D=pcall(function()local E=d.player or b.Players.LocalPlayer;b.TeleportService:Teleport(game.PlaceId,E)end)if D then p.retryDelay=2 else p.retryDelay=math.min(p.maxDelay,p.retryDelay+2)end end;local function F()if p.enabled then return end;p.enabled=true;p.pending=false;p.nextAttemptAt=0;p.retryDelay=2;p.token=p.token+1;local G=p.token;p.loop=task.spawn(function()while p.enabled and p.token==G do if u()then z("error_prompt")end;if p.pending then B()end;task.wait(1)end end)local E=d.player;if E then q(E.Kicked:Connect(function()z("kicked")end))if E.OnTeleport then q(E.OnTeleport:Connect(function(H)if H==Enum.TeleportState.Failed then z("teleport_failed")elseif H==Enum.TeleportState.Started then p.pending=false end end))end end;q(b.TeleportService.TeleportInitFailed:Connect(function(E)if E==d.player then z("teleport_init_failed")end end))end;local function I()if not p.enabled then return end;p.token=p.token+1;p.enabled=false;p.pending=false;p.nextAttemptAt=0;p.retryDelay=2;r()end;local J=c.Player:AddRightGroupbox("Utils","lightbulb")if l.NoClip then J:AddToggle("NoclipEnabled",{Text="NoClip",Default=false,Tooltip="Walk through any structures"}):AddKeyPicker("NoclipKey",{Default="N",SyncToggleState=true,Mode="Toggle"})f.NoclipEnabled:OnChanged(function()if f.NoclipEnabled.Value then if j then j()end;e:Notify("NoClip enabled.",2)else if k then k()end;e:Notify("NoClip disabled.",2)end end)end;if l.Desync then J:AddToggle("DesyncEnabled",{Text="Desync",Default=false,Tooltip="Perform movements and actions client-side without server recognition until re-synced"}):AddKeyPicker("DesyncKey",{Default=nil,SyncToggleState=true,Mode="Toggle"})local K=type(server_desync)=="function"local L=type(setfflag)=="function"local M=false;local N=false;f.DesyncEnabled:OnChanged(function()if N then return end;local O=f.DesyncEnabled.Value;if K then server_desync(O)e:Notify("Server Desync "..(O and"enabled."or"disabled."),2)return end;if not L then e:Notify("Desync not available (no server_desync / setfflag in this executor).",3)if O then N=true;f.DesyncEnabled:SetValue(false)N=false end;return end;if O and not M then M=true;N=true;f.DesyncEnabled:SetValue(false)N=false;e:Notify("FFlag desync uses NextGenReplicatorEnabledWrite4.\n".."It is unstable and potentially detectable.\n\n".."Click the toggle again if you still want to enable it.",6)return end;local P=O and"true"or"false"local D,Q=pcall(function()setfflag("NextGenReplicatorEnabledWrite4",P)end)if not D then e:Notify("Failed to apply FFlag desync: "..tostring(Q),3)N=true;f.DesyncEnabled:SetValue(false)N=false;return end;if O then e:Notify("FFlag Desync enabled (use with caution).",4)else e:Notify("FFlag Desync disabled.",2)end end)end;if l.AutoUseTool then local function R()if not d.character or not d.character.Parent then return nil end;for S,T in ipairs(d.character:GetChildren())do if T:IsA("Tool")then return T end end end;J:AddToggle("AutoUseTool",{Text="AutoUse Tool",Default=false,Tooltip="Automatically activates your equipped tool"}):AddKeyPicker("AutoUseKey",{Default=nil,SyncToggleState=true,Mode="Toggle"})local U=false;local V=nil;V=n(b.RunService.Heartbeat:Connect(function()local W=(f.AutoUseTool and f.AutoUseTool.Value)==true;if W~=U then U=W;e:Notify(W and"AutoUse enabled."or"AutoUse disabled.",2)local X=R()if X then pcall(function()if W then X:Activate()else X:Deactivate()end end)end end;if W then local X=R()if X then pcall(function()X:Activate()end)end end end))end;if l.Zoom.Enabled then local Y={on=false,conn=nil,origFov=nil,strength=2}local function Z()local _=d.camera or workspace.CurrentCamera;if not(_ and Y.origFov)then return end;_.FieldOfView=math.clamp(Y.origFov/math.max(0.1,Y.strength),10,120)end;local function a0()Y.on=false;if Y.conn then pcall(function()Y.conn:Disconnect()end)Y.conn=nil end;local _=d.camera or workspace.CurrentCamera;if _ and Y.origFov then pcall(function()_.FieldOfView=Y.origFov end)end end;local tg=J:AddToggle("ZOOM_Enable",{Text="Zoom",Default=false,Callback=function(W)local _=d.camera or workspace.CurrentCamera;if not _ then e:Notify("Camera not ready.",3)if tg.SetValue then tg:SetValue(false)end;return end;if W then if not Y.origFov then Y.origFov=_.FieldOfView end;Y.on=true;Z()if not Y.conn then Y.conn=n(b.RunService.RenderStepped:Connect(function()if Y.on then Z()end end))end else a0()end end}):AddKeyPicker("ZoomKey",{Default=nil,SyncToggleState=true,Mode="Toggle"})if l.Zoom.ZoomStrength.Enabled then J:AddSlider("ZOOM_Strength",{Text="Zoom Strength",Default=l.Zoom.ZoomStrength.Default or 2,Min=l.Zoom.ZoomStrength.Min or 1,Max=l.Zoom.ZoomStrength.Max or 10,Rounding=1,Callback=function(a1)Y.strength=a1;if Y.on then Z()end end})else Y.strength=2 end end;if l.PerformanceMode then J:AddToggle("PerformanceMode",{Text="Performance Mode",Default=false,Tooltip="Reduce visual effects locally for better FPS"})local a2=nil;local function a3()if a2 then return end;a2={QualityLevel=settings().Rendering.QualityLevel,GlobalShadows=b.Lighting.GlobalShadows,Ambient=b.Lighting.Ambient,Brightness=b.Lighting.Brightness,FogEnd=b.Lighting.FogEnd,FogStart=b.Lighting.FogStart,Effects={},Terrain={}}for S,T in ipairs(b.Lighting:GetDescendants())do if T:IsA("BloomEffect")or T:IsA("ColorCorrectionEffect")or T:IsA("SunRaysEffect")or T:IsA("DepthOfFieldEffect")or T:IsA("BlurEffect")then a2.Effects[T]=T.Enabled end end;local a4=b.Workspace:FindFirstChildOfClass("Terrain")if a4 then a2.Terrain.WaterWaveSize=a4.WaterWaveSize;a2.Terrain.WaterReflectance=a4.WaterReflectance;a2.Terrain.WaterTransparency=a4.WaterTransparency;local D,a5=pcall(function()return a4.Decoration end)if D and type(a5)=="boolean"then a2.Terrain.Decoration=a5 end end end;local function a6()a3()settings().Rendering.QualityLevel=Enum.QualityLevel.Level01;b.Lighting.GlobalShadows=false;b.Lighting.Ambient=Color3.new(0.3,0.3,0.3)b.Lighting.Brightness=1;b.Lighting.FogEnd=1e10;b.Lighting.FogStart=1e10;for T in pairs(a2.Effects)do if T and T.Parent then T.Enabled=false end end;local a4=b.Workspace:FindFirstChildOfClass("Terrain")if a4 then a4.WaterWaveSize=0;a4.WaterReflectance=0;a4.WaterTransparency=1;if a2.Terrain.Decoration~=nil then pcall(function()a4.Decoration=false end)end end;for S,a7 in ipairs(b.Workspace:GetDescendants())do if a7:IsA("ParticleEmitter")or a7:IsA("Trail")or a7:IsA("Beam")or a7:IsA("Smoke")or a7:IsA("Fire")then if a7.Enabled then a7:SetAttribute("PerfWasEnabled",true)a7.Enabled=false end end end end;local function a8()if not a2 then return end;settings().Rendering.QualityLevel=a2.QualityLevel;b.Lighting.GlobalShadows=a2.GlobalShadows;b.Lighting.Ambient=a2.Ambient;b.Lighting.Brightness=a2.Brightness;b.Lighting.FogEnd=a2.FogEnd;b.Lighting.FogStart=a2.FogStart;for T,a9 in pairs(a2.Effects)do if T and T.Parent then T.Enabled=a9 end end;local a4=b.Workspace:FindFirstChildOfClass("Terrain")if a4 then a4.WaterWaveSize=a2.Terrain.WaterWaveSize or a4.WaterWaveSize;a4.WaterReflectance=a2.Terrain.WaterReflectance or a4.WaterReflectance;a4.WaterTransparency=a2.Terrain.WaterTransparency or a4.WaterTransparency;if a2.Terrain.Decoration~=nil then pcall(function()a4.Decoration=a2.Terrain.Decoration end)end end;for S,a7 in ipairs(b.Workspace:GetDescendants())do if a7:GetAttribute("PerfWasEnabled")then a7:SetAttribute("PerfWasEnabled",nil)if a7.Enabled~=nil then a7.Enabled=true end end end;a2=nil end;f.PerformanceMode:OnChanged(function()if f.PerformanceMode.Value then a6()else a8()end end)end;if l.RemoveKillBricks then local aa={}local function ab(W)if not W then for ac,ad in pairs(aa)do if ac and ac.Parent then ac.CanTouch=ad.touch;ac.CanCollide=ad.collide;ac.Transparency=ad.trans end end;table.clear(aa)return end;for S,a1 in ipairs(b.Workspace:GetDescendants())do if a1:IsA("BasePart")then local ae=a1.Name:lower()if ae:find("kill")or ae:find("lava")or ae:find("damage")then aa[a1]={touch=a1.CanTouch,collide=a1.CanCollide,trans=a1.Transparency}a1.CanTouch=false;a1.CanCollide=false;a1.Transparency=0.5 end end end end;J:AddToggle("RemoveKillBricks",{Text="Remove KillBricks",Default=false,Tooltip="Disable bricks that cause death/damage",Callback=function(a1)ab(a1)end})end;if l.ModSafety then local af={notify=false,leave=false}local function ag(E)local D,ah=pcall(function()return E:GetAttribute("AdminLevel")end)if D and type(ah)=="number"and ah>0 then return true end;local ai=E:GetAttribute("IsAdmin")or E:GetAttribute("Moderator")or E:GetAttribute("Staff")if ai==true then return true end;return false end;local function aj(E)if not(af.notify or af.leave)then return end;if not E or E==d.player then return end;if not ag(E)then return end;if af.notify then e:Notify("Moderator joined: "..E.Name,6)end;if af.leave then task.defer(function()if d.player and d.player.Parent then b.TeleportService:Teleport(game.PlaceId,d.player)end end)end end;local ak=n(b.Players.PlayerAdded:Connect(aj))local function al()if not(af.notify or af.leave)then return end;for S,E in ipairs(b.Players:GetPlayers())do aj(E)end end;J:AddToggle("ModNotifierToggle",{Text="Mod Notifier",Default=false,Tooltip="Notify when a moderator/staff joins",Callback=function(a1)af.notify=a1;if a1 then al()end end})J:AddToggle("LeaveOnModToggle",{Text="Leave If Mod Joins",Default=false,Tooltip="Auto-leave the server if a moderator/staff joins",Callback=function(a1)af.leave=a1;if a1 then al()end end})end;if l.AutoRejoin then J:AddToggle("AutoRejoin",{Text="Auto Rejoin",Default=false,Tooltip="Rejoin the game on kick, disconnect, or teleport failure",Callback=function(a1)if a1 then F()else I()end end})end;if l.AntiAFK then J:AddToggle("AntiAFK_Toggle",{Text="Anti-AFK",Default=false,Callback=function(am)if am then if not getgenv()._AntiAFK_Conn then getgenv()._AntiAFK_Conn=n(game:GetService("Players").LocalPlayer.Idled:Connect(function()game:GetService("VirtualUser"):CaptureController()game:GetService("VirtualUser"):ClickButton2(Vector2.new())end))end else if getgenv()._AntiAFK_Conn then getgenv()._AntiAFK_Conn:Disconnect()getgenv()._AntiAFK_Conn=nil end end end})end;if l.FPSCap then J:AddInput("UTILS_FPSCap",{Text="FPS Cap",Placeholder="Enter target FPS",Default="60",Numeric=true,Finished=true,Tooltip="Set a custom FPS limit",Callback=function(an)local ao=tonumber(an)if ao and ao>0 then if setfpscap then setfpscap(ao)e:Notify(("FPS cap set to %d"):format(ao),3)else e:Notify("FPS unlocker not supported in this executor.",3)end else e:Notify("Please enter a positive number for FPS.",3)end end})end;if l.QuickReset then J:AddButton({Text="Quick Reset",Func=function()i()end})end;if h then h:Register(function()I()for s=#m,1,-1 do local t=m[s]m[s]=nil;pcall(function()if t and t.Disconnect then t:Disconnect()end end)end end)end;return{}end
