return function(a)local b=a.Services;local c=a.Tabs;local d=a.References;local e=a.Library;local f=a.Options;local g=a.Toggles;local h=a.Unloader;local i=a.MovementConfig;local j={}if i.Enabled~=true then return end;local k={}local l,m;local n,o;local p,q;local r;local s;local t;local u;local function v(w)if w then k[#k+1]=w end;return w end;if i.Flight.Enabled then local x=c.Player:AddLeftGroupbox("Flight","move-3d")x:AddToggle("FlightEnabled",{Text="Flight",Default=false}):AddKeyPicker("FlightKey",{Default="Y",SyncToggleState=true,Mode="Toggle"})if i.Flight.FlightSpeed.Enabled then x:AddSlider("FlightSpeed",{Text="Flight Speed",Default=i.Flight.FlightSpeed.Default or 100,Min=i.Flight.FlightSpeed.Min or 30,Max=i.Flight.FlightSpeed.Max or 400,Rounding=0})else f.FlightSpeed.Value=100 end;local y;local function startFlight()if y then return end;e:Notify("Flight enabled.",2)y=v(b.RunService.RenderStepped:Connect(function()if not d.humanoidRootPart or not d.camera then return end;local z=d.camera.CFrame;local A,B,C=z.LookVector,z.RightVector,z.UpVector;local D=Vector3.zero;local E=Enum.KeyCode;if b.UserInputService:IsKeyDown(E.W)then D=D+A end;if b.UserInputService:IsKeyDown(E.S)then D=D-A end;if b.UserInputService:IsKeyDown(E.A)then D=D-B end;if b.UserInputService:IsKeyDown(E.D)then D=D+B end;if b.UserInputService:IsKeyDown(E.Space)then D=D+C end;if b.UserInputService:IsKeyDown(E.LeftShift)or b.UserInputService:IsKeyDown(E.LeftControl)then D=D-C end;if d.humanoid and b.UserInputService.TouchEnabled then local F=d.humanoid.MoveDirection;if F.Magnitude>0 then D=D+A*F.Z*-1+B*F.X end end;local G=f.FlightSpeed.Value;if D.Magnitude>0 then d.humanoidRootPart.AssemblyAngularVelocity=Vector3.zero;d.humanoidRootPart.AssemblyLinearVelocity=D.Unit*G else d.humanoidRootPart.AssemblyAngularVelocity=Vector3.zero;d.humanoidRootPart.AssemblyLinearVelocity=Vector3.new(0,2.2,0)end end))end;local function stopFlight()if y then e:Notify("Flight disabled.",2)y:Disconnect()y=nil;if d.humanoidRootPart then d.humanoidRootPart.AssemblyAngularVelocity=Vector3.zero;d.humanoidRootPart.AssemblyLinearVelocity=Vector3.zero end end end;g.FlightEnabled:OnChanged(function()if g.FlightEnabled.Value then startFlight()else stopFlight()end end)end;if i.Speed.Enabled then local H=c.Player:AddLeftGroupbox("Speed","move")H:AddToggle("SpeedEnabled",{Text="Speed",Default=false}):AddKeyPicker("SpeedKey",{Default="G",SyncToggleState=true,Mode="Toggle"})if i.Speed.SpeedSlider.Enabled then H:AddSlider("SpeedValue",{Text="Speed Value",Default=i.Speed.SpeedSlider.Default or 30,Min=i.Speed.SpeedSlider.Min or 16,Max=i.Speed.SpeedSlider.Max or 300,Rounding=0})end;local function I()local J=d.humanoid;if not J then return end;if t~=J or s==nil then t=J;s=J.WalkSpeed end end;l=function()if r then return end;e:Notify("Speed enabled.",2)I()r=v(b.RunService.Heartbeat:Connect(function()local J=d.humanoid;if J then I()J.WalkSpeed=f.SpeedValue.Value end end))end;m=function(K)if r then if not K then e:Notify("Speed disabled.",2)end;r:Disconnect()r=nil end;local J=d.humanoid;if J and t==J and s~=nil then J.WalkSpeed=s end;s=nil;t=nil end;g.SpeedEnabled:OnChanged(function()if g.SpeedEnabled.Value then l()else m()end end)end;if i.Jump.Enabled then local L=c.Player:AddLeftGroupbox("Jump","move-vertical")L:AddToggle("JumpPower",{Text="Jump Power",Default=false})if i.Jump.JumpHeight.Enabled then L:AddSlider("JumpHeight",{Text="Jump Height",Default=i.Jump.JumpHeight.Default or 7.2,Min=i.Jump.JumpHeight.Min or 5,Max=i.Jump.JumpHeight.Max or 200,Rounding=1})else f.JumpHeight.Value=7.2 end;if i.Jump.InfiniteJump then L:AddToggle("InfiniteJump",{Text="Infinite Jump",Default=false})else g.InfiniteJump.Value=false end;local function M()if not d.humanoid then return end;local N=tonumber(f.JumpHeight.Value)or 50;local O=workspace.Gravity or 196.2;local P=math.sqrt(math.max(0,2*O*N))if d.humanoid.UseJumpPower~=nil then d.humanoid.UseJumpPower=true end;if d.humanoid.JumpPower~=nil then d.humanoid.JumpPower=P end end;local Q=nil;local R;n=function()if R then return end;local J=d.humanoid;if J and not Q then Q={UseJumpPower=J.UseJumpPower,JumpPower=J.JumpPower,JumpHeight=J.JumpHeight}end;M()R=v(b.RunService.Heartbeat:Connect(function()M()end))end;o=function()if R then R:Disconnect()R=nil end;local J=d.humanoid;if J and Q then if J.UseJumpPower~=nil then J.UseJumpPower=Q.UseJumpPower end;if J.JumpPower~=nil then J.JumpPower=Q.JumpPower end;if J.JumpHeight~=nil then J.JumpHeight=Q.JumpHeight end end end;local S,T=nil,false;p=function()if S then return end;S=v(b.UserInputService.JumpRequest:Connect(function()if not g.InfiniteJump.Value then return end;local J=d.humanoid;if not J or T then return end;T=true;task.defer(function()pcall(function()J:ChangeState(Enum.HumanoidStateType.Jumping)J.Jump=true end)task.wait()T=false end)end))end;q=function()if S then S:Disconnect()S=nil end;T=false end;g.JumpPower:OnChanged(function()if g.JumpPower.Value then n()else o()end end)if i.Jump.JumpHeight then f.JumpHeight:OnChanged(function()if g.JumpPower.Value then M()end end)end;if i.Jump.InfiniteJump then g.InfiniteJump:OnChanged(function()if g.InfiniteJump.Value then p()else q()end end)end end;if i.ClickToTp then local U=c.Player:AddLeftGroupbox("Click Teleport","mouse-pointer-click")U:AddToggle("ClickTPEnabled",{Text="Click To Teleport",Default=false,Tooltip="Hold the chosen key and right-click anywhere to instantly teleport there."}):AddKeyPicker("ClickTPKey",{Default="Q",SyncToggleState=false,Mode="Hold"})local V;local function W()if V then return end;V=v(b.UserInputService.InputBegan:Connect(function(X,Y)if Y then return end;if X.UserInputType==Enum.UserInputType.MouseButton2 and b.UserInputService:IsKeyDown(Enum.KeyCode[f.ClickTPKey.Value])then local Z=b.UserInputService:GetMouseLocation()local _=d.camera:ViewportPointToRay(Z.X,Z.Y)local a0=workspace:Raycast(_.Origin,_.Direction*1000,RaycastParams.new())if a0 and d.humanoidRootPart then d.humanoidRootPart.CFrame=CFrame.new(a0.Position+Vector3.new(0,3,0))end end end))end;local function a1()if V then V:Disconnect()V=nil end end;g.ClickTPEnabled:OnChanged(function()if g.ClickTPEnabled.Value then W()else a1()end end)f.ClickTPKey:OnChanged(function()end)end;if i.CTW.Enabled then local a2=c.Player:AddLeftGroupbox("Click To Walk","mouse-pointer")a2:AddToggle("ClickToWalk",{Text="Enable Click To Walk",Default=false})if i.CTW.WalkSpeed.Enabled then a2:AddSlider("CTW_Speed",{Text="Walk Speed",Default=i.CTW.WalkSpeed.Default or 16,Min=i.CTW.WalkSpeed.Min or 8,Max=i.CTW.WalkSpeed.Max or 300,Rounding=0,Suffix=" studs/s"})else f.CTW_Speed.Value=16 end;local a3=i.Dev.MaxHopDistance or 700;local a4=i.Dev.MinRepathInterval or 0.3;local a5=0;local a6,a7,a8,a9;local aa;local ab;local ac;local ad;local ae=nil;local af=0;local ag=false;local ah=nil;local ai={}local function aj()local J=d.humanoid;if not J then return end;if ah==nil then ah=J.WalkSpeed end;J.WalkSpeed=f.CTW_Speed.Value end;local function ak()local J=d.humanoid;if J and ah~=nil then J.WalkSpeed=ah end;ah=nil end;local function al(am)if not am then return end;for an,ao in ipairs(am:GetDescendants())do if ao:IsA("BasePart")then b.TweenService:Create(ao,TweenInfo.new(0.25),{Transparency=1}):Play()end end;task.delay(0.3,function()pcall(function()if am then am:Destroy()end end)end)end;local function ap()if a9 then a9:Disconnect()a9=nil end;if ac then al(ac)ac=nil end end;local function aq()if ab then al(ab)ab=nil end end;local function ar()ap()aq()end;local function as()local J,at=d.humanoid,d.humanoidRootPart;if J then pcall(function()if at then J:MoveTo(at.Position)end end)pcall(function()J:Move(Vector3.zero)end)end end;local function au()if a7 then a7:Disconnect()a7=nil end;if a8 then a8:Disconnect()a8=nil end;aa=nil end;local function av()for aw,ax in pairs(ai)do if ax then ax:Disconnect()end;ai[aw]=nil end end;local function ay()if not ag then ar()au()ak()av()ad,ae,af=nil,nil,0;return end;ag=false;as()ar()au()ak()av()ad,ae,af=nil,nil,0 end;u=function()ay()if a6 then a6:Disconnect()a6=nil end end;local function az(aA)ap()ac=Instance.new("Folder")ac.Name="CTW_Beacon"ac.Parent=workspace;local aB=Instance.new("Part")aB.Name="Pillar"aB.Anchored,aB.CanCollide=true,false;aB.Material=Enum.Material.Neon;aB.Color=Color3.fromRGB(55,235,120)aB.Size=Vector3.new(0.25,12,0.25)aB.CFrame=CFrame.new(aA+Vector3.new(0,aB.Size.Y/2,0))aB.Parent=ac;local aC=Instance.new("Part")aC.Name="Ring"aC.Shape=Enum.PartType.Cylinder;aC.Anchored,aC.CanCollide=true,false;aC.Material=Enum.Material.Neon;aC.Color=Color3.fromRGB(55,235,120)aC.Size=Vector3.new(2,0.2,2)aC.CFrame=CFrame.new(aA)*CFrame.Angles(math.rad(90),0,0)aC.Parent=ac;local aD=Instance.new("Part")aD.Name="Glow"aD.Anchored,aD.CanCollide=true,false;aD.Material=Enum.Material.Neon;aD.Color=Color3.fromRGB(55,235,120)aD.Transparency=0.5;aD.Size=Vector3.new(1.5,0.15,1.5)aD.CFrame=CFrame.new(aA+Vector3.new(0,0.05,0))aD.Parent=ac;b.TweenService:Create(aC,TweenInfo.new(0.8,Enum.EasingStyle.Quad,Enum.EasingDirection.Out,-1,true),{Size=Vector3.new(6,aC.Size.Y,6)}):Play()b.TweenService:Create(aB,TweenInfo.new(0.8,Enum.EasingStyle.Sine,Enum.EasingDirection.InOut,-1,true),{Transparency=0.25}):Play()local aE=0;a9=v(b.RunService.Heartbeat:Connect(function(aF)if not aC or not aC.Parent then return end;aE=aE+aF*math.pi/2;aC.CFrame=CFrame.new(aA)*CFrame.Angles(math.rad(90),aE,0)end))end;local function aG(aH)aq()ab=Instance.new("Folder")ab.Name="CTW_Path"ab.Parent=workspace;for aI=1,#aH do local aJ=Instance.new("Part")aJ.Name="CTW_Waypoint"aJ.Anchored,aJ.CanCollide=true,false;aJ.Material=Enum.Material.Neon;aJ.Color=Color3.fromRGB(55,235,120)aJ.Size=Vector3.new(0.35,0.35,0.35)aJ.Shape=Enum.PartType.Ball;aJ.CFrame=CFrame.new(aH[aI].Position+Vector3.new(0,0.15,0))aJ.Parent=ab end;for aI=1,#aH-1 do local aK,aL=aH[aI].Position,aH[aI+1].Position;local aM=Instance.new("Part")aM.Name="CTW_Segment"aM.Anchored,aM.CanCollide=true,false;aM.Material=Enum.Material.Neon;aM.Color=Color3.fromRGB(55,235,120)aM.Size=Vector3.new(0.15,0.15,(aK-aL).Magnitude)aM.CFrame=CFrame.new((aK+aL)/2,aL)aM.Transparency=1;aM.Parent=ab;b.TweenService:Create(aM,TweenInfo.new(0.2),{Transparency=0}):Play()end end;local function aN(aO,aP)local aQ=aP-aO;local aR=aQ.Magnitude;if aR<1 then return{aP}end;local D=aQ.Unit;local aS,aT={},0;while aT+a3<aR do aT=aT+a3;aS[#aS+1]=aO+D*aT end;aS[#aS+1]=aP;return aS end;local function aU(aV,aK,aL)local aW=os.clock()local aX=a4-(aW-a5)if aX>0 then task.wait(aX)end;a5=os.clock()local aY,aZ=pcall(function()aV:ComputeAsync(aK,aL)end)if not aY then return false,aZ end;return true end;local function a_()av()ai.WASD=v(b.UserInputService.InputBegan:Connect(function(X,Y)if Y then return end;local b0=X.KeyCode;if b0==Enum.KeyCode.W or b0==Enum.KeyCode.A or b0==Enum.KeyCode.S or b0==Enum.KeyCode.D then ay()end end))ai.GP=v(b.UserInputService.InputChanged:Connect(function(X,Y)if Y then return end;if X.UserInputType==Enum.UserInputType.Gamepad1 and X.KeyCode==Enum.KeyCode.Thumbstick1 then if X.Position.Magnitude>0.15 then ay()end end end))ai.RMB=v(b.UserInputService.InputBegan:Connect(function(X,Y)if Y then return end;if X.UserInputType==Enum.UserInputType.MouseButton2 then ay()end end))if d.player then ai.CharAdded=v(d.player.CharacterAdded:Connect(function()ay()end))end;local J=d.humanoid;if J then ai.Died=v(J.Died:Connect(ay))ai.Seated=v(J.Seated:Connect(function(b1)if b1 then ay()end end))ai.Ancestry=v(J.AncestryChanged:Connect(function(an,b2)if b2==nil then ay()end end))end end;local function b3(b4,b5)if not ag then return end;local b6=b.PathfindingService:CreatePath({AgentRadius=2,AgentHeight=5,AgentCanJump=true,WaypointSpacing=4})aa=b6;local aY=aU(b6,b4,b5)if not aY or b6.Status~=Enum.PathStatus.Success then local b7=b4:Lerp(b5,0.5)aY=aU(b6,b4,b7)if not aY or b6.Status~=Enum.PathStatus.Success then e:Notify("Unable to compute path.",3)ay()return else if ae then table.insert(ae,af,b7)end end end;if not ag then return end;local b8=b6:GetWaypoints()if#b8==0 then e:Notify("No waypoints for this segment.",3)ay()return end;aG(b8)if a8 then a8:Disconnect()a8=nil end;a8=v(b6.Blocked:Connect(function()if not ag then return end;local at=d.humanoidRootPart;if at and ad and ae then b3(at.Position,ae[af])end end))if a7 then a7:Disconnect()a7=nil end;local aI=1;local J=d.humanoid;if not J then ay()return end;J:MoveTo(b8[aI].Position)a7=v(J.MoveToFinished:Connect(function(b9)if not ag then return end;if aa~=b6 then return end;if not b9 then local at=d.humanoidRootPart;if at and ae then b3(at.Position,ae[af])else ay()end;return end;aI=aI+1;if b8[aI]then J:MoveTo(b8[aI].Position)else af=af+1;if ae and ae[af]then local at=d.humanoidRootPart;if at then b3(at.Position,ae[af])else ay()end else ay()end end end))end;local function ba()if a6 then return end;a6=v(b.UserInputService.InputBegan:Connect(function(X,Y)if Y then return end;if X.UserInputType~=Enum.UserInputType.MouseButton1 then return end;local bb=d.player and d.player:GetMouse()if not bb or not bb.Hit then return end;local aP=bb.Hit.Position;if ag then ay()end;ad=aP;ar()az(aP)local at=d.humanoidRootPart;local J=d.humanoid;if not(at and J)then ay()return end;ag=true;aj()a_()ae=aN(at.Position,aP)af=1;b3(at.Position,ae[af])end))end;g.ClickToWalk:OnChanged(function()if g.ClickToWalk.Value then ba()else u()end end)f.CTW_Speed:OnChanged(function(G)if ag and d.humanoid then d.humanoid.WalkSpeed=G end end)end;if i.Flight.Enabled then j.startFlight=startFlight;j.stopFlight=stopFlight end;if i.Jump.Enabled then j.startJumpMod=n;j.stopJumpMod=o;j.startInfiniteJump=p;j.stopInfiniteJump=q end;if i.Speed.Enabled then j.startSpeed=l;j.stopSpeed=m end;if h then h:Register(function()if u then u()end;if m then m(true)end;if o then o()end;if q then q()end;for aI=#k,1,-1 do local ax=k[aI]k[aI]=nil;pcall(function()if ax and ax.Disconnect then ax:Disconnect()end end)end end)end;return j end
