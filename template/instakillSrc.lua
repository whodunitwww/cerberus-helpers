return function(a)local b=a.Services;local c=a.Tabs;local d=a.References;local e=a.Library;local f=a.Options;local g=a.Unloader;local h=a.InstakillConfig;if h.Enabled~=true then return end;local i={}local function j(k)if k then i[#i+1]=k end end;local l=c.Main:AddRightGroupbox("Instakill","skull")local m={on=false,range=150,thr=30,acc=0,tick=nil,addConn=nil}local n={}local function o(p)return b.Players:GetPlayerFromCharacter(p)~=nil end;local function q(p)if not(p and p:IsA("Model"))then return end;if p==d.character then return end;if o(p)then return end;local r=p:FindFirstChildOfClass("Humanoid")if not r then n[p]=nil;return end;local s=p:FindFirstChild("HumanoidRootPart")if not s then n[p]=nil;return end;n[p]={h=r,r=s}end;for t,u in ipairs(b.Workspace:GetDescendants())do if u:IsA("Model")then q(u)end end;local function v()if m.addConn then m.addConn:Disconnect()end;m.addConn=j(b.Workspace.DescendantAdded:Connect(function(u)local p=u:IsA("Model")and u or u.Parent;if p and p:IsA("Model")then q(p)end end))end;local function w()if m.addConn then m.addConn:Disconnect()m.addConn=nil end end;local function x(p,r,s)local y=d.humanoidRootPart;if not(p and r and s and y)then return false end;pcall(function()sethiddenproperty(d.player,"SimulationRadius",1e5)sethiddenproperty(d.player,"MaxSimulationRadius",1e5)end)local z={}for t,u in ipairs(p:GetDescendants())do if u:IsA("BasePart")then pcall(function()u:SetNetworkOwner(d.player)end)elseif u:IsA("NumberValue")or u:IsA("IntValue")then local A=u.Name:lower()if A:find("health")or A:find("hp")then z[#z+1]=u end end end;local B=os.clock()+0.25;local C=r.MaxHealth and r.MaxHealth>0 and r.MaxHealth or 100;local D=C*10+1000;repeat pcall(function()r:TakeDamage(D)end)pcall(function()r.Health=0 end)pcall(function()r:ChangeState(Enum.HumanoidStateType.Dead)end)for E=1,#z do pcall(function()z[E].Value=0 end)end;pcall(function()p:SetAttribute("CurrentState","Unconscious")end)b.RunService.Heartbeat:Wait()until os.clock()>B or not p.Parent;local F=not p.Parent or not p:FindFirstChildOfClass("Humanoid")return F end;local function G()if not d.humanoidRootPart then return end;for p,H in pairs(n)do local r,s=H.h,H.r;if not p or not p.Parent or not r or not r.Parent or r.Parent~=p then n[p]=nil else local u=(d.humanoidRootPart.Position-s.Position).Magnitude;if u<=m.range then local I=r.MaxHealth and r.MaxHealth>0 and r.MaxHealth or 100;local J=r.Health/I*100;if J<=m.thr or r.Health<=0 then if x(p,r,s)then n[p]=nil end end end end end end;local function K()if m.tick then return end;v()m.acc=0;m.tick=j(b.RunService.Heartbeat:Connect(function(L)m.acc=m.acc+L;if m.acc>=h.Dev.Step or 0.12 then m.acc=0;pcall(G)end end))end;local function M()if m.tick then m.tick:Disconnect()m.tick=nil end;w()end;l:AddToggle("IK_Toggle",{Text="Instakill",Tooltip=h.Dev.Tooltip or"This ONLY works on mobs NOT players, and only sometimes.",Default=false,Callback=function(N)m.on=N;if N then K()else M()end end})if h.IKRange.Enabled then l:AddSlider("IK_Range",{Text="Range",Default=h.IKRange.Default or 150,Min=h.IKRange.Min or 10,Max=h.IKRange.Max or 1000,Rounding=0,Suffix=" studs",Callback=function(N)m.range=N end})else m.range=150 end;if h.IKThreshold.Enabled then l:AddSlider("IK_Threshold",{Text="Health Threshold",Default=h.IKThreshold.Default or 30,Min=h.IKThreshold.Min or 0,Max=h.IKThreshold.Max or 100,Rounding=0,Suffix="%",Tooltip="Kill when target HP% is at/below this value",Callback=function(N)m.thr=N end})else m.thr=30 end;if g then g:Register(function()for E=#i,1,-1 do local O=i[E]i[E]=nil;pcall(function()if O and O.Disconnect then O:Disconnect()end end)end end)end;return{}end
